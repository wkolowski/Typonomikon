<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="coqdoc.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery-3.5.1.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="MyStyles.js"></script>
<title>Typonomikon</title>
</head>
<h1 class="libtitle">G2: Typy zagnieżdżone parametrowo i rekursja polimorficzna [TODO]</h1>

<div class="code">
</div>

<div class="doc">

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Bool</span> <span class="id" title="var">Recdef</span> <span class="id" title="var">Equality</span> <span class="id" title="var">FunctionalExtensionality</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Typonomikon</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">D5</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab747"></a><h1 class="section">Parametry a indeksy (TODO)</h1>

<div class="paragraph"> </div>

<a id="lab748"></a><h1 class="section">Rekursja polimorficzna</h1>

<div class="paragraph"> </div>

<a id="lab749"></a><h1 class="section">Zupełne drzewa binarne (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Complete</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Pomysł&nbsp;na&nbsp;<span class="inlinecode"><span class="id" title="var">Complete</span></span>&nbsp;wzięty<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class='link' href='http://comonad.com/reader/wp-content/uploads/2010/04/Finger-Trees.pdf'>
    stąd</a>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Complete</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">Empty</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">Layer</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Complete</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">Empty</span> {<span class="id" title="var">A</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">Layer</span> {<span class="id" title="var">A</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">CompleteC</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">F</span> : <span class="id" title="keyword">Type</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">empty</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">F</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">layer</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">A</span> -&gt; <span class="id" title="var">F</span> (<span class="id" title="var">prod</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">F</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">F</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">empty</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} : <span class="id" title="var">CompleteC</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">F</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">e</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">layer</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">CompleteC</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">CompleteC</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">F</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">l</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> (<span class="id" title="var">t</span> <span class="id" title="var">F</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">C2CC</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">CompleteC</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">empty</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">layer</span> <span class="id" title="var">x</span> (<span class="id" title="var">C2CC</span> <span class="id" title="var">t</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">CC2C</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">CompleteC</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">t</span> <span class="id" title="var">Complete</span> (@<span class="id" title="var">Empty</span>) (@<span class="id" title="var">Layer</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">C2CC2C</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">CC2C</span> (<span class="id" title="var">C2CC</span> <span class="id" title="var">t</span>) = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">t'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">compute</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt'</span> <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">CC2C</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">layer</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">leftmost</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span>      =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">t'</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">leftmost</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span>   =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">l</span>, <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">rightmost</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span>      =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">t'</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">rightmost</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span>   =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">_</span>, <span class="id" title="var">r</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">B</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span>      =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">Layer</span> (<span class="id" title="var">f</span> <span class="id" title="var">v</span>) (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; (<span class="id" title="var">f</span> <span class="id" title="var">x</span>, <span class="id" title="var">f</span> <span class="id" title="var">y</span>)) <span class="id" title="var">t'</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> * <span class="id" title="var">B</span>) : <span class="id" title="var">B</span> * <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
| (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; (<span class="id" title="var">y</span>, <span class="id" title="var">x</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">mirror</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span>      =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> (<span class="id" title="var">map</span> <span class="id" title="var">swap</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t'</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">nums</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
| 0    =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">Layer</span> <span class="id" title="var">n</span> (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="var">x</span>, <span class="id" title="var">x</span>)) (<span class="id" title="var">nums</span> <span class="id" title="var">n'</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">test</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Layer</span> 0 (<br/>
&nbsp;&nbsp;<span class="id" title="var">Layer</span> (0, 1) (<br/>
&nbsp;&nbsp;<span class="id" title="var">Layer</span> (0, 1, (2, 3)) (<br/>
&nbsp;&nbsp;<span class="id" title="var">Empty</span>))).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_id</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">id</span> <span class="id" title="var">t</span> = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt</span> <span class="id" title="tactic">at</span> 2. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_map</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">g</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>) = <span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">g</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)) <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">t</span>. <span class="id" title="var">revert</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">leftmost_map</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leftmost</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">leftmost</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span>   =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">revert</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">leftmost</span> <span class="id" title="var">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">leftmost_mirror</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leftmost</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t</span>) = <span class="id" title="var">rightmost</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">leftmost_map</span>, <span class="id" title="var">IHt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">rightmost</span> <span class="id" title="var">t</span>) <span class="id" title="keyword">as</span> [[] |]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_mirror</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">f</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t</span>) = <span class="id" title="var">mirror</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">t</span>. <span class="id" title="var">revert</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt</span>, !<span class="id" title="var">map_map</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mirror_mirror</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mirror</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t</span>) = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">map_mirror</span>, <span class="id" title="var">map_map</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt</span> <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">map_id</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">size</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; 0<br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">ts</span> =&gt; 1 + <span class="id" title="var">size</span> <span class="id" title="var">ts</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">height</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; 0<br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">_</span> <span class="id" title="var">ts</span> =&gt; 1 + <span class="id" title="var">height</span> <span class="id" title="var">ts</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">flatten</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
| [] =&gt; []<br/>
| (<span class="id" title="var">hl</span>, <span class="id" title="var">hr</span>) :: <span class="id" title="var">t</span> =&gt; <span class="id" title="var">hl</span> :: <span class="id" title="var">hr</span> :: <span class="id" title="var">flatten</span> <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">bfs</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; []<br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">ts</span> =&gt; <span class="id" title="var">v</span> :: <span class="id" title="var">flatten</span> (<span class="id" title="var">bfs</span> <span class="id" title="var">ts</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">complete</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
| 0 =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">Layer</span> <span class="id" title="var">x</span> (<span class="id" title="var">complete</span> <span class="id" title="var">n'</span> (<span class="id" title="var">x</span>, <span class="id" title="var">x</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">any</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">false</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">ts</span> =&gt; <span class="id" title="var">p</span> <span class="id" title="var">v</span> || <span class="id" title="var">any</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> || <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">ts</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">all</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">true</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">ts</span> =&gt; <span class="id" title="var">p</span> <span class="id" title="var">v</span> &amp;&amp; <span class="id" title="var">all</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> &amp;&amp; <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">ts</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">find</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">v</span> <span class="id" title="var">ts</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">p</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">find</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> || <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">ts</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">p</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">x</span> <span class="id" title="keyword">else</span> <span class="id" title="var">Some</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">zipWith</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">ta</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>) (<span class="id" title="var">tb</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">B</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">C</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">ta</span>, <span class="id" title="var">tb</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">_</span>, <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">Layer</span> <span class="id" title="var">a</span> <span class="id" title="var">ta'</span>, <span class="id" title="var">Layer</span> <span class="id" title="var">b</span> <span class="id" title="var">tb'</span> =&gt; <span class="id" title="var">Layer</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="var">zipWith</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">al</span>, <span class="id" title="var">ar</span>) '(<span class="id" title="var">bl</span>, <span class="id" title="var">br</span>) =&gt; (<span class="id" title="var">f</span> <span class="id" title="var">al</span> <span class="id" title="var">bl</span>, <span class="id" title="var">f</span> <span class="id" title="var">ar</span> <span class="id" title="var">br</span>)) <span class="id" title="var">ta'</span> <span class="id" title="var">tb'</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">left</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">Layer</span> (<span class="id" title="var">a</span>, <span class="id" title="var">_</span>) <span class="id" title="var">ts</span> =&gt; <span class="id" title="var">Layer</span> <span class="id" title="var">a</span> (<span class="id" title="tactic">left</span> <span class="id" title="var">ts</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">right</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Empty</span> =&gt; <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">Layer</span> (<span class="id" title="var">_</span>, <span class="id" title="var">a</span>) <span class="id" title="var">ts</span> =&gt; <span class="id" title="var">Layer</span> <span class="id" title="var">a</span> (<span class="id" title="tactic">right</span> <span class="id" title="var">ts</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*Fixpoint&nbsp;count&nbsp;{A&nbsp;:&nbsp;Type}&nbsp;(p&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;bool)&nbsp;(t&nbsp;:&nbsp;Complete&nbsp;A)&nbsp;:&nbsp;nat&nbsp;:=<br/>
match&nbsp;t&nbsp;with<br/>
|&nbsp;Empty&nbsp;=&gt;&nbsp;0<br/>
|&nbsp;Layer&nbsp;v&nbsp;ts&nbsp;=&gt;&nbsp;(if&nbsp;p&nbsp;v&nbsp;then&nbsp;1&nbsp;else&nbsp;0)&nbsp;+&nbsp;count&nbsp;(fun&nbsp;(x,&nbsp;y)&nbsp;=&gt;&nbsp;ts<br/>
end.*)</span><br/>

<br/>
<span class="comment">(*&nbsp;TODO<br/>
<br/>
Parameter&nbsp;leaf&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;isEmpty&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;bool.<br/>
<br/>
Parameter&nbsp;root&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;A.<br/>
<br/>
Parameter&nbsp;unN&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;(A&nbsp;*&nbsp;BTree&nbsp;A&nbsp;*&nbsp;BTree&nbsp;A).<br/>
<br/>
Parameter&nbsp;inorder&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A.<br/>
Parameter&nbsp;preorder&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A.<br/>
Parameter&nbsp;postorder&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A.<br/>
<br/>
Parameter&nbsp;iterate&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;A)&nbsp;-&gt;&nbsp;nat&nbsp;-&gt;&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;index&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;list&nbsp;bool&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;A.<br/>
Parameter&nbsp;nth&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;A.<br/>
<br/>
Parameter&nbsp;take&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
Parameter&nbsp;drop&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;(BTree&nbsp;A).<br/>
Parameter&nbsp;takedrop&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;*&nbsp;list&nbsp;(BTree&nbsp;A).<br/>
<br/>
Parameter&nbsp;intersperse&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;insertAtLeaf&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;list&nbsp;bool&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;findIndex&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;(list&nbsp;bool).<br/>
<br/>
Parameter&nbsp;takeWhile&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;findIndices&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;(list&nbsp;bool).<br/>
<br/>
Parameter&nbsp;unzipWith&nbsp;:<br/>
&nbsp;forall&nbsp;A&nbsp;B&nbsp;C&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;B&nbsp;*&nbsp;C)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;B&nbsp;*&nbsp;BTree&nbsp;C.<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Complete'</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">P</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">Empty'</span> : <span class="id" title="var">Complete'</span> <span class="id" title="var">P</span> <span class="id" title="var">Empty</span><br/>
| <span class="id" title="var">Layer'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> (<span class="id" title="var">prod</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">Complete'</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">prod</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) (<span class="id" title="var">P</span> <span class="id" title="var">y</span>)) <span class="id" title="var">t</span> -&gt; <span class="id" title="var">Complete'</span> <span class="id" title="var">P</span> (<span class="id" title="var">Layer</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span>).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">Complete_ind_deep</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>), <span class="id" title="var">Complete</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">empty</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span> <span class="id" title="var">Empty</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">layer</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Q</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">P</span> (<span class="id" title="var">prod</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">prod</span> (<span class="id" title="var">Q</span> <span class="id" title="var">x</span>) (<span class="id" title="var">Q</span> <span class="id" title="var">y</span>)) <span class="id" title="var">t</span> -&gt; <span class="id" title="var">P</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span> (<span class="id" title="var">Layer</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span>))<br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;{<span class="id" title="var">t</span> : <span class="id" title="var">Complete</span> <span class="id" title="var">A</span>} (<span class="id" title="var">t'</span> : <span class="id" title="var">Complete'</span> <span class="id" title="var">Q</span> <span class="id" title="var">t</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">t'</span>} : <span class="id" title="var">P</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x</span> <span class="id" title="var">t</span> <span class="id" title="var">Qx</span> <span class="id" title="var">Ct</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">empty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">layer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">Qx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Complete_ind_deep</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Complete</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab750"></a><h1 class="section"><span class="inlinecode"><span class="id" title="var">PTree</span></span>, cokolwiek to jest (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">PTree</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">PTree</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">L</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">PTree</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">N</span> : <span class="id" title="var">PTree</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">L</span> {<span class="id" title="var">A</span>} <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">N</span> {<span class="id" title="var">A</span>} <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">PTree</span> <span class="id" title="var">B</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">L</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)<br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">N</span> (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; (<span class="id" title="var">f</span> <span class="id" title="var">x</span>, <span class="id" title="var">f</span> <span class="id" title="var">y</span>)) <span class="id" title="var">t'</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> * <span class="id" title="var">B</span>) : <span class="id" title="var">B</span> * <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
| (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; (<span class="id" title="var">y</span>, <span class="id" title="var">x</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">mirror</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">L</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">N</span> (<span class="id" title="var">map</span> <span class="id" title="var">swap</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t'</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">leftmost</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">leftmost</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span>        =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>, <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">rightmost</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">rightmost</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span>        =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">_</span>, <span class="id" title="var">x</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">size</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; 0<br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; 1 + <span class="id" title="var">size</span> <span class="id" title="var">t'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">height</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span> =&gt; 0<br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; 1 + <span class="id" title="var">height</span> <span class="id" title="var">t'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">flatten</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
| [] =&gt; []<br/>
| (<span class="id" title="var">hl</span>, <span class="id" title="var">hr</span>) :: <span class="id" title="var">t</span> =&gt; <span class="id" title="var">hl</span> :: <span class="id" title="var">hr</span> :: <span class="id" title="var">flatten</span> <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">bfs</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span> =&gt; [<span class="id" title="var">x</span>]<br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">flatten</span> (<span class="id" title="var">bfs</span> <span class="id" title="var">t'</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">complete</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
| 0 =&gt; <span class="id" title="var">L</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">N</span> (<span class="id" title="var">complete</span> <span class="id" title="var">n'</span> (<span class="id" title="var">x</span>, <span class="id" title="var">x</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">any</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">any</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> || <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">t'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">all</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">all</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> &amp;&amp; <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">t'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">find</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">p</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">x</span> <span class="id" title="keyword">else</span> <span class="id" title="var">None</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">find</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> || <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span>        =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">p</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">x</span> <span class="id" title="keyword">else</span> <span class="id" title="var">Some</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*<br/>
Fixpoint&nbsp;zipWith&nbsp;{A&nbsp;B&nbsp;C&nbsp;:&nbsp;Type}&nbsp;(f&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;B&nbsp;-&gt;&nbsp;C)&nbsp;(ta&nbsp;:&nbsp;PTree&nbsp;A)&nbsp;(tb&nbsp;:&nbsp;PTree&nbsp;B)&nbsp;:&nbsp;PTree&nbsp;C&nbsp;:=<br/>
match&nbsp;ta,&nbsp;tb&nbsp;with<br/>
|&nbsp;L&nbsp;x,&nbsp;L&nbsp;y&nbsp;=&gt;&nbsp;L&nbsp;(f&nbsp;x&nbsp;y)<br/>
|&nbsp;_,&nbsp;L&nbsp;x&nbsp;=&gt;&nbsp;L&nbsp;x<br/>
|&nbsp;Layer&nbsp;a&nbsp;ta',&nbsp;Layer&nbsp;b&nbsp;tb'&nbsp;=&gt;&nbsp;Layer&nbsp;(f&nbsp;a&nbsp;b)&nbsp;(zipWith&nbsp;(fun&nbsp;'(al,&nbsp;ar)&nbsp;'(bl,&nbsp;br)&nbsp;=&gt;&nbsp;(f&nbsp;al&nbsp;bl,&nbsp;f&nbsp;ar&nbsp;br))&nbsp;ta'&nbsp;tb')<br/>
end.<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">left</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> (<span class="id" title="var">x</span>, <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">L</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span>     =&gt; <span class="id" title="var">N</span> (<span class="id" title="tactic">left</span> <span class="id" title="var">t'</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">right</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> (<span class="id" title="var">A</span> * <span class="id" title="var">A</span>)) : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> (<span class="id" title="var">x</span>, <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">L</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span>     =&gt; <span class="id" title="var">N</span> (<span class="id" title="tactic">right</span> <span class="id" title="var">t'</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">count</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">nat</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">L</span> <span class="id" title="var">x</span>  =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span><br/>
| <span class="id" title="var">N</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">count</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) =&gt; <span class="id" title="var">p</span> <span class="id" title="var">x</span> + <span class="id" title="var">p</span> <span class="id" title="var">y</span>) <span class="id" title="var">t'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO<br/>
<br/>
Parameter&nbsp;leaf&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;isL&nbsp;x&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;bool.<br/>
<br/>
Parameter&nbsp;root&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;A.<br/>
<br/>
Parameter&nbsp;unN&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;(A&nbsp;*&nbsp;BTree&nbsp;A&nbsp;*&nbsp;BTree&nbsp;A).<br/>
<br/>
Parameter&nbsp;inorder&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A.<br/>
Parameter&nbsp;preorder&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A.<br/>
Parameter&nbsp;postorder&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A.<br/>
<br/>
Parameter&nbsp;iterate&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;A)&nbsp;-&gt;&nbsp;nat&nbsp;-&gt;&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;index&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;list&nbsp;bool&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;A.<br/>
Parameter&nbsp;nth&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;A.<br/>
<br/>
Parameter&nbsp;take&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
Parameter&nbsp;drop&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;(BTree&nbsp;A).<br/>
Parameter&nbsp;takedrop&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;nat&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;*&nbsp;list&nbsp;(BTree&nbsp;A).<br/>
<br/>
Parameter&nbsp;intersperse&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;insertAtLeaf&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;list&nbsp;bool&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;findIndex&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;option&nbsp;(list&nbsp;bool).<br/>
<br/>
Parameter&nbsp;takeWhile&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;A.<br/>
<br/>
Parameter&nbsp;findIndices&nbsp;:<br/>
&nbsp;&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;(list&nbsp;bool).<br/>
<br/>
Parameter&nbsp;unzipWith&nbsp;:<br/>
&nbsp;forall&nbsp;A&nbsp;B&nbsp;C&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;B&nbsp;*&nbsp;C)&nbsp;-&gt;&nbsp;BTree&nbsp;A&nbsp;-&gt;&nbsp;BTree&nbsp;B&nbsp;*&nbsp;BTree&nbsp;C.<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_id</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">id</span> <span class="id" title="var">t</span> = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt</span> <span class="id" title="tactic">at</span> 2. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_map</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">g</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>) = <span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">g</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)) <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">t</span>. <span class="id" title="var">revert</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">leftmost_map</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leftmost</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">leftmost</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span>   =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">revert</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">leftmost</span> <span class="id" title="var">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">leftmost_mirror</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">leftmost</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t</span>) = <span class="id" title="var">rightmost</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">leftmost_map</span>, <span class="id" title="var">IHt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">rightmost</span> <span class="id" title="var">t</span>) <span class="id" title="keyword">as</span> [[] |]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_mirror</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">f</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t</span>) = <span class="id" title="var">mirror</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">t</span>. <span class="id" title="var">revert</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt</span>, !<span class="id" title="var">map_map</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mirror_mirror</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">PTree</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mirror</span> (<span class="id" title="var">mirror</span> <span class="id" title="var">t</span>) = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">map_mirror</span>, <span class="id" title="var">map_map</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt</span> <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">map_id</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*<br/>
Inductive&nbsp;PTree'&nbsp;{A&nbsp;:&nbsp;Type}&nbsp;(P&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;Type)&nbsp;:&nbsp;PTree&nbsp;A&nbsp;-&gt;&nbsp;Type&nbsp;:=<br/>
|&nbsp;L&nbsp;x'&nbsp;:&nbsp;PTree'&nbsp;P&nbsp;L&nbsp;x<br/>
|&nbsp;Layer'&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;(x&nbsp;:&nbsp;A)&nbsp;(t&nbsp;:&nbsp;PTree&nbsp;(prod&nbsp;A&nbsp;A)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;x&nbsp;-&gt;&nbsp;PTree'&nbsp;(fun&nbsp;'(x,&nbsp;y)&nbsp;=&gt;&nbsp;prod&nbsp;(P&nbsp;x)&nbsp;(P&nbsp;y))&nbsp;t&nbsp;-&gt;&nbsp;PTree'&nbsp;P&nbsp;(Layer&nbsp;x&nbsp;t).<br/>
<br/>
Fixpoint&nbsp;PTree_ind_deep<br/>
&nbsp;&nbsp;(P&nbsp;:&nbsp;forall&nbsp;(A&nbsp;:&nbsp;Type)&nbsp;(Q&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;Type),&nbsp;PTree&nbsp;A&nbsp;-&gt;&nbsp;Type)<br/>
&nbsp;&nbsp;(empty&nbsp;:&nbsp;forall&nbsp;(A&nbsp;:&nbsp;Type)&nbsp;(Q&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;Type),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;A&nbsp;Q&nbsp;L&nbsp;x)<br/>
&nbsp;&nbsp;(layer&nbsp;:&nbsp;forall&nbsp;(A&nbsp;:&nbsp;Type)&nbsp;(Q&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;Type)&nbsp;(x&nbsp;:&nbsp;A)&nbsp;(t&nbsp;:&nbsp;PTree&nbsp;(A&nbsp;*&nbsp;A)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;x&nbsp;-&gt;&nbsp;P&nbsp;(prod&nbsp;A&nbsp;A)&nbsp;(fun&nbsp;'(x,&nbsp;y)&nbsp;=&gt;&nbsp;prod&nbsp;(Q&nbsp;x)&nbsp;(Q&nbsp;y))&nbsp;t&nbsp;-&gt;&nbsp;P&nbsp;A&nbsp;Q&nbsp;(Layer&nbsp;x&nbsp;t))<br/>
&nbsp;&nbsp;{A&nbsp;:&nbsp;Type}&nbsp;(Q&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;Type)<br/>
&nbsp;&nbsp;{t&nbsp;:&nbsp;PTree&nbsp;A}&nbsp;(t'&nbsp;:&nbsp;PTree'&nbsp;Q&nbsp;t)&nbsp;{struct&nbsp;t'}&nbsp;:&nbsp;P&nbsp;A&nbsp;Q&nbsp;t.<br/>
Proof.<br/>
&nbsp;&nbsp;destruct&nbsp;t'&nbsp;as&nbsp;<span class="inlinecode">|</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">Qx</span></span> <span class="inlinecode"><span class="id" title="var">Ct</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;empty.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;layer.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exact&nbsp;Qx.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;PTree_ind_deep;&nbsp;assumption.<br/>
Defined.<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">PTree</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab751"></a><h1 class="section">Zagnieżdżone listy (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Nested</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Nested</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">Epsilon</span><br/>
| <span class="id" title="var">Cons</span> (<span class="id" title="var">h</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Nested</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>)).<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">Epsilon</span> {<span class="id" title="var">A</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">Cons</span>    {<span class="id" title="var">A</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Nested'</span> : <span class="id" title="keyword">Type</span> -&gt; <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">Epsilon'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">Nested'</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">Cons'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Nested'</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">Nested'</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">len</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">Nested</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Epsilon</span> =&gt; 0<br/>
| <span class="id" title="var">Cons</span> <span class="id" title="var">_</span> <span class="id" title="var">t</span> =&gt; 1 + <span class="id" title="var">len</span> <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">size</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">Nested</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Epsilon</span> =&gt; 0<br/>
| <span class="id" title="var">Cons</span> <span class="id" title="var">_</span> <span class="id" title="var">Epsilon</span> =&gt; 1<br/>
| <span class="id" title="var">Cons</span> <span class="id" title="var">_</span> (<span class="id" title="var">Cons</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>) =&gt; <span class="id" title="var">length</span> <span class="id" title="var">h</span> + <span class="id" title="var">size</span> <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wut</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">Nested</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">len</span> <span class="id" title="var">l</span> &lt;= <span class="id" title="var">size</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h</span> <span class="id" title="var">t</span>]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h'</span> <span class="id" title="var">t'</span>]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHl</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Nested</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab752"></a><h1 class="section">Zagnieżdżone listy niepuste (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Nested2</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Nested</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">Singl</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Nested</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">Nestd</span> : <span class="id" title="var">Nested</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">Nested</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Nested2</span>.<br/>
</div>
