<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="coqdoc.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery-3.5.1.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="MyStyles.js"></script>
<title>Typonomikon</title>
</head>
<h1 class="libtitle">H2z: Izomorfizmy typów [TODO]</h1>

<div class="code">
</div>

<div class="doc">

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Equality</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FunctionalExtensionality</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Typonomikon</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">B3b</span> <span class="id" title="var">C2c</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab993"></a><h1 class="section">Typy zależne</h1>

</div>
<div class="code">

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_pi_fun</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B2</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B1</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">A</span>, <span class="id" title="var">iso</span> (<span class="id" title="var">B1</span> <span class="id" title="var">x</span>) <span class="id" title="var">B2</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">iso</span> (<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">A</span>, <span class="id" title="var">B1</span> <span class="id" title="var">x</span>) (<span class="id" title="var">A</span> -&gt; <span class="id" title="var">B2</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> <span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">coel</span> (<span class="id" title="var">i</span> <span class="id" title="var">a</span>) (<span class="id" title="var">f</span> <span class="id" title="var">a</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> <span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">coer</span> (<span class="id" title="var">i</span> <span class="id" title="var">a</span>) (<span class="id" title="var">f</span> <span class="id" title="var">a</span>);<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">coel_coer</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">coer_coel</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_sigT_prod</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B2</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B1</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">A</span>, <span class="id" title="var">iso</span> (<span class="id" title="var">B1</span> <span class="id" title="var">x</span>) <span class="id" title="var">B2</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">iso</span> {<span class="id" title="var">x</span> : <span class="id" title="var">A</span> &amp; <span class="id" title="var">B1</span> <span class="id" title="var">x</span>} (<span class="id" title="var">A</span> * <span class="id" title="var">B2</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> '(<span class="id" title="var">existT</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span> <span class="id" title="var">b1</span>) := (<span class="id" title="var">a</span>, <span class="id" title="var">coel</span> (<span class="id" title="var">i</span> <span class="id" title="var">a</span>) <span class="id" title="var">b1</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> '(<span class="id" title="var">a</span>, <span class="id" title="var">b2</span>) := <span class="id" title="var">existT</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span> (<span class="id" title="var">coer</span> (<span class="id" title="var">i</span> <span class="id" title="var">a</span>) <span class="id" title="var">b2</span>);<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">coel_coer</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">coer_coel</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab994"></a><h1 class="section">Izomorfizmy charakterystyczne typów induktywnych (TODO)</h1>

<div class="paragraph"> </div>

<a id="lab995"></a><h2 class="section">Liczby naturalne</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pred</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">option</span> <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
| 0 =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">n'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">unpred</span> (<span class="id" title="var">on</span> : <span class="id" title="var">option</span> <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">on</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">None</span> =&gt; 0<br/>
| <span class="id" title="var">Some</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">S</span> <span class="id" title="var">n</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_nat_option_nat</span> : <span class="id" title="var">iso</span> <span class="id" title="var">nat</span> (<span class="id" title="var">option</span> <span class="id" title="var">nat</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> <span class="id" title="var">n</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> | 0 =&gt; <span class="id" title="var">None</span> | <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">n'</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> <span class="id" title="var">o</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">o</span> <span class="id" title="keyword">with</span> | <span class="id" title="var">None</span> =&gt; 0 | <span class="id" title="var">Some</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">S</span> <span class="id" title="var">n</span> <span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [].<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab996"></a><h2 class="section">Listy</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">uncons</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">A</span> * <span class="id" title="var">list</span> <span class="id" title="var">A</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
| [] =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">h</span> :: <span class="id" title="var">t</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">h</span>, <span class="id" title="var">t</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ununcons</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">option</span> (<span class="id" title="var">A</span> * <span class="id" title="var">list</span> <span class="id" title="var">A</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">None</span> =&gt; []<br/>
| <span class="id" title="var">Some</span> (<span class="id" title="var">h</span>, <span class="id" title="var">t</span>) =&gt; <span class="id" title="var">h</span> :: <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">list_char</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">iso</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">option</span> (<span class="id" title="var">A</span> * <span class="id" title="var">list</span> <span class="id" title="var">A</span>)) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| []     =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">h</span> :: <span class="id" title="var">t</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">h</span>, <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> <span class="id" title="var">o</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">o</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span>        =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">h</span>, <span class="id" title="var">t</span>) =&gt; <span class="id" title="var">h</span> :: <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [[] |].<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab997"></a><h2 class="section">Strumienie</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Typonomikon</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">F2</span>.<br/>

<br/>
</div>

<div class="doc">
Jak można się domyślić po przykładach, charakterystyczne izomorfizmy
    dla prostych typów induktywnych są łatwe. A co z innowacyjniejszymi
    rodzajami definicji induktywnych oraz z definicjami koinduktywnymi?
    Sprawdźmy to! 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Axiom</span> <span class="id" title="var">sim_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">A</span>), <span class="id" title="var">sim</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> -&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">Stream_char</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">iso</span> (<span class="id" title="var">Stream</span> <span class="id" title="var">A</span>) (<span class="id" title="var">A</span> * <span class="id" title="var">Stream</span> <span class="id" title="var">A</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> <span class="id" title="var">s</span> := (<span class="id" title="var">hd</span> <span class="id" title="var">s</span>, <span class="id" title="var">tl</span> <span class="id" title="var">s</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> '(<span class="id" title="var">a</span>, <span class="id" title="var">s</span>) := {| <span class="id" title="var">hd</span> := <span class="id" title="var">a</span>; <span class="id" title="var">tl</span> := <span class="id" title="var">s</span> |}<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intro</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sim_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">s</span>]; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab998"></a><h1 class="section">Charakteryzacje "kontenerowe" (TODO)</h1>

<div class="paragraph"> </div>

<a id="lab999"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">Stream</span></span> <span class="inlinecode"><span class="id" title="var">unit</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">unit</span></span></h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FinFun</span> <span class="id" title="var">ZArith</span>.<br/>

<br/>
<span class="id" title="keyword">CoFixpoint</span> <span class="id" title="var">theChosenOne</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">unit</span> :=<br/>
{|<br/>
&nbsp;&nbsp;<span class="id" title="var">hd</span> := <span class="id" title="var">tt</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">tl</span> := <span class="id" title="var">theChosenOne</span>;<br/>
|}.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">all_chosen_unit_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">s</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">unit</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sim</span> <span class="id" title="var">s</span> <span class="id" title="var">theChosenOne</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">all_chosen_unit</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">unit</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sim</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">all_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">unit</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> = <span class="id" title="var">y</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">unit_to_stream</span> (<span class="id" title="var">u</span> : <span class="id" title="var">unit</span>) : <span class="id" title="var">Stream</span> <span class="id" title="var">unit</span> := <span class="id" title="var">theChosenOne</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">stream_to_unit</span> (<span class="id" title="var">s</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">unit</span>) : <span class="id" title="var">unit</span> := <span class="id" title="var">tt</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unit_is_Stream_unit</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Bijective</span> <span class="id" title="var">unit_to_stream</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1000"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">Stream</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">A</span></span></h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">index</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">s</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">F2.nth</span> <span class="id" title="var">n</span> <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">CoFixpoint</span> <span class="id" title="var">memoize</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">A</span>) : <span class="id" title="var">Stream</span> <span class="id" title="var">A</span> :=<br/>
{|<br/>
&nbsp;&nbsp;<span class="id" title="var">hd</span> := <span class="id" title="var">f</span> 0;<br/>
&nbsp;&nbsp;<span class="id" title="var">tl</span> := <span class="id" title="var">memoize</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>));<br/>
|}.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">index_memoize</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">index</span> (<span class="id" title="var">memoize</span> <span class="id" title="var">f</span>) <span class="id" title="var">n</span> = <span class="id" title="var">f</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span>; <span class="id" title="var">revert</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<span class="id" title="var">F2.nth</span> <span class="id" title="var">n'</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">index</span> (<span class="id" title="var">memoize</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>))) <span class="id" title="var">n'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">memoize_index</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">s</span> : <span class="id" title="var">Stream</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sim</span> (<span class="id" title="var">memoize</span> (<span class="id" title="var">index</span> <span class="id" title="var">s</span>)) <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">CH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="var">cbn</span>; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">CH</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1001"></a><h1 class="section">Charakteryzacje "wektorowe" (TODO)</h1>

<div class="paragraph"> </div>

<a id="lab1002"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode">~</span> <span class="inlinecode">{<span class="id" title="var">n</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">&amp;</span> <span class="inlinecode"><span class="id" title="var">vec</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">n</span>}</span></h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden".<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Typonomikon</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">E1</span>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "notation-overridden".<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">vlist</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;{<span class="id" title="var">n</span> : <span class="id" title="var">nat</span> &amp; <span class="id" title="var">vec</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span>}.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">vectorize'</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">vec</span> <span class="id" title="var">A</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">vnil</span><br/>
| <span class="id" title="var">cons</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">vcons</span> <span class="id" title="var">h</span> (<span class="id" title="var">vectorize'</span> <span class="id" title="var">t</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">vectorize</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">vlist</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">existT</span> <span class="id" title="var">_</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span>) (<span class="id" title="var">vectorize'</span> <span class="id" title="var">l</span>).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">toList</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">v</span> : <span class="id" title="var">vec</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">v</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">vnil</span> =&gt; <span class="id" title="var">nil</span><br/>
| <span class="id" title="var">vcons</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">cons</span> <span class="id" title="var">h</span> (<span class="id" title="var">toList</span> <span class="id" title="var">t</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">listize</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">v</span> : <span class="id" title="var">vlist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">toList</span> (<span class="id" title="var">projT2</span> <span class="id" title="var">v</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eq_head_tail</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">v1</span> <span class="id" title="var">v2</span> : <span class="id" title="var">vec</span> <span class="id" title="var">A</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">head</span> <span class="id" title="var">v1</span> = <span class="id" title="var">head</span> <span class="id" title="var">v2</span> -&gt; <span class="id" title="var">tail</span> <span class="id" title="var">v1</span> = <span class="id" title="var">tail</span> <span class="id" title="var">v2</span> -&gt; <span class="id" title="var">v1</span> = <span class="id" title="var">v2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">v1</span>; <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">v2</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> -&gt; -&gt;.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Typonomikon</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">C3z</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">transport_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">vec</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">n</span> = <span class="id" title="var">m</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transport</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span> =&gt; <span class="id" title="var">vec</span> <span class="id" title="var">A</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)) <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> :: <span class="id" title="var">t</span>) = <span class="id" title="var">h</span> :: <span class="id" title="var">transport</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span> =&gt; <span class="id" title="var">vec</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span>) <span class="id" title="var">p</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_list_vlist</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">iso</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">vlist</span> <span class="id" title="var">A</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> := <span class="id" title="var">vectorize</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> := <span class="id" title="var">listize</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">a</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h</span> <span class="id" title="var">t</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHt</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">n</span> <span class="id" title="var">v</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">vectorize</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">v</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h</span> <span class="id" title="var">t</span>]; <span class="id" title="var">cbn</span>; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sigT_eq'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHv</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHv</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">e</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">sigT_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">ap</span> <span class="id" title="var">S</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_ap</span>, <span class="id" title="var">transport_cons</span>, <span class="id" title="var">e</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1003"></a><h1 class="section">Ciekawsze izomorfizmy</h1>

<div class="paragraph"> </div>

<a id="lab1004"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">nat</span></span></h2>

<div class="paragraph"> </div>

 Jak trudno jest zrobić ciekawsze izomorfizmy? 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">div2</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> + <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
| 0 =&gt; <span class="id" title="var">inl</span> 0<br/>
| 1 =&gt; <span class="id" title="var">inr</span> 0<br/>
| <span class="id" title="var">S</span> (<span class="id" title="var">S</span> <span class="id" title="var">n'</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">div2</span> <span class="id" title="var">n'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">inl</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">inl</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">inr</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">undiv2</span> (<span class="id" title="var">x</span> : <span class="id" title="var">nat</span> + <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">inl</span> <span class="id" title="var">n</span> =&gt; 2 * <span class="id" title="var">n</span><br/>
| <span class="id" title="var">inr</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">S</span> (2 * <span class="id" title="var">n</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_nat_sum_nat_nat</span> : <span class="id" title="var">iso</span> <span class="id" title="var">nat</span> (<span class="id" title="var">nat</span> + <span class="id" title="var">nat</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> := <span class="id" title="var">div2</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> := <span class="id" title="var">undiv2</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">functional</span> <span class="id" title="tactic">induction</span> (<span class="id" title="var">div2</span> <span class="id" title="var">a</span>); <span class="id" title="var">cbn</span>; [<span class="id" title="var">easy</span>.. | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHs</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">plus_n_Sm</span>, <span class="id" title="var">IHs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHs</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">plus_n_Sm</span>, <span class="id" title="var">IHs</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n</span> | <span class="id" title="var">n</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">functional</span> <span class="id" title="tactic">induction</span> (<span class="id" title="var">div2</span> <span class="id" title="var">n</span>); <span class="id" title="var">cbn</span>; [<span class="id" title="var">easy</span>.. | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- 2!<span class="id" title="var">plus_n_Sm</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- 2!<span class="id" title="var">plus_n_Sm</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n'</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n''</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">plus_n_Sm</span>, <span class="id" title="var">IHn'</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Niezbyt trudno, ale łatwo też nie. 
<div class="paragraph"> </div>

<a id="lab1005"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">*</span> <span class="inlinecode"><span class="id" title="var">nat</span></span></h2>

<div class="paragraph"> </div>

<a id="lab1006"></a><h3 class="section"><span class="inlinecode"><span class="id" title="var">goto</span></span></h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">goto'</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> * <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span>, <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
| 0   , <span class="id" title="var">_</span>    =&gt; (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>)<br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span>, 0    =&gt; <span class="id" title="var">goto'</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>) 0 <span class="id" title="var">n'</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span>, <span class="id" title="var">S</span> <span class="id" title="var">x'</span> =&gt; <span class="id" title="var">goto'</span> <span class="id" title="var">x'</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>) <span class="id" title="var">n'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">goto</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> * <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">goto'</span> 0 0 <span class="id" title="var">n</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">goto'_add</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">x'</span> <span class="id" title="var">y'</span>: <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> = (<span class="id" title="var">x'</span>, <span class="id" title="var">y'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> (<span class="id" title="var">n</span> + <span class="id" title="var">m</span>) = <span class="id" title="var">goto'</span> <span class="id" title="var">x'</span> <span class="id" title="var">y'</span> <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">functional</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="var">inv</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IHp</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IHp</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">goto'_small</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">n</span> &lt;= <span class="id" title="var">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> = (<span class="id" title="var">x</span> - <span class="id" title="var">n</span>, <span class="id" title="var">y</span> + <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> <span class="id" title="var">Hle</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">functional</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span>; <span class="id" title="var">cbn</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">f_equal</span>; <span class="id" title="var">lia</span> | <span class="id" title="var">now</span> <span class="id" title="var">lia</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHp</span>; [<span class="id" title="tactic">f_equal</span> |]; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">goto'_right</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> (1 + <span class="id" title="var">x</span> + <span class="id" title="var">y</span>) = (<span class="id" title="var">S</span> <span class="id" title="var">x</span>, <span class="id" title="var">y</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (1 + <span class="id" title="var">x</span> + <span class="id" title="var">y</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> + (1 + <span class="id" title="var">y</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">goto'_add</span>; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">goto'_small</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.sub_diag</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">goto'_small</span>; [<span class="id" title="tactic">f_equal</span> |]; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">goto_add</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto</span> (<span class="id" title="var">n</span> + <span class="id" title="var">m</span>) = <span class="id" title="var">goto'</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">goto</span> <span class="id" title="var">n</span>)) (<span class="id" title="var">snd</span> (<span class="id" title="var">goto</span> <span class="id" title="var">n</span>)) <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">goto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">goto'_add</span>; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> (<span class="id" title="var">goto'</span> 0 0 <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1007"></a><h3 class="section"><span class="inlinecode"><span class="id" title="var">comefrom</span></span></h3>

<div class="paragraph"> </div>

 Chcielibyśmy zdefiniować funkcję odwrotną do <span class="inlinecode"><span class="id" title="var">goto'</span></span> w ten sposób:

<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="var">comefrom</span></span> <span class="inlinecode">(0,</span> <span class="inlinecode">0)</span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>

<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="var">comefrom</span></span> <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode">0)</span> <span class="inlinecode">=</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">comefrom</span></span> <span class="inlinecode">(0,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span>

<div class="paragraph"> </div>

    <span class="inlinecode"><span class="id" title="var">comefrom</span></span> <span class="inlinecode">(<span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">comefrom</span></span> <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span>

<div class="paragraph"> </div>

    Niestety takie równania nie są strukturalnie rekurencyjne, więc definicja
    nie jest akceptowana przez Coqa. Próba ratowania sytuacji za pomocą rekursji
    dobrze ufundowanej też by się nie powiodła (wiem bo próbowałem).

<div class="paragraph"> </div>

    Zamiast tego, użyjemy nieco przerobionej definicji, a potem spróbujemy pokazać,
    że spełnia ona powyższe równania. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">comefrom'</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">x</span>} : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
| 0 =&gt;<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">fix</span> <span class="id" title="var">aux</span> (<span class="id" title="var">y</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">y</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0    =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">y'</span> =&gt; 1 + <span class="id" title="var">y</span> + <span class="id" title="var">aux</span> <span class="id" title="var">y'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) <span class="id" title="var">y</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">x'</span> =&gt; <span class="id" title="var">x</span> + <span class="id" title="var">y</span> + <span class="id" title="var">comefrom'</span> <span class="id" title="var">x'</span> <span class="id" title="var">y</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">comefrom</span> (<span class="id" title="var">xy</span> : <span class="id" title="var">nat</span> * <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> (<span class="id" title="var">fst</span> <span class="id" title="var">xy</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">xy</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom'_eq_1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> 0 0 = 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom'_eq_2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> (<span class="id" title="var">S</span> <span class="id" title="var">x</span>) 0 = 1 + <span class="id" title="var">comefrom'</span> 0 <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x'</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom'_eq_3</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> <span class="id" title="var">x</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>) = 1 + <span class="id" title="var">comefrom'</span> (<span class="id" title="var">S</span> <span class="id" title="var">x</span>) <span class="id" title="var">y</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x'</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHx'</span> <span class="id" title="var">y</span>); <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom'_right</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> (<span class="id" title="var">S</span> <span class="id" title="var">x</span>) <span class="id" title="var">y</span> = 1 + <span class="id" title="var">x</span> + <span class="id" title="var">y</span> + <span class="id" title="var">comefrom'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x'</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>; [<span class="id" title="var">now</span> <span class="id" title="var">lia</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHx'</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom'_up</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> <span class="id" title="var">x</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>) = 2 + <span class="id" title="var">x</span> + <span class="id" title="var">y</span> + <span class="id" title="var">comefrom'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x'</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>; [<span class="id" title="var">now</span> <span class="id" title="var">lia</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHx'</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom'_goto'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> <span class="id" title="var">x'</span> <span class="id" title="var">y'</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span> = (<span class="id" title="var">x'</span>, <span class="id" title="var">y'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">comefrom'</span> <span class="id" title="var">x'</span> <span class="id" title="var">y'</span> = <span class="id" title="var">comefrom'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> + <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">functional</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">goto'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="var">inv</span> <span class="id" title="var">H</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>), <span class="id" title="var">comefrom'_eq_2</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>), <span class="id" title="var">comefrom'_eq_3</span>; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">comefrom_goto</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">comefrom</span> (<span class="id" title="var">goto</span> <span class="id" title="var">n</span>) = <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">goto</span> <span class="id" title="var">n</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">x</span> <span class="id" title="var">y</span>] <span class="id" title="var">eqn</span>: <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">comefrom</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">comefrom'_goto'</span> 0 0 <span class="id" title="var">n</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>); <span class="id" title="var">cbn</span>; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">Heq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">goto_comefrom</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xy</span> : <span class="id" title="var">nat</span> * <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">goto</span> (<span class="id" title="var">comefrom</span> <span class="id" title="var">xy</span>) = <span class="id" title="var">xy</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">x</span> <span class="id" title="var">y</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">comefrom</span>, <span class="id" title="var">fst</span>, <span class="id" title="var">snd</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x'</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">y</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">y'</span>]; [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">comefrom'_up</span>, <span class="id" title="var">Nat.add_comm</span>, <span class="id" title="var">goto_add</span>, <span class="id" title="var">IHy'</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">goto'_small</span>; [| <span class="id" title="var">easy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">f_equal</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">comefrom'_right</span>, <span class="id" title="var">Nat.add_comm</span>, <span class="id" title="var">goto_add</span>, <span class="id" title="var">IHx'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fst</span>, <span class="id" title="var">snd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">goto'_right</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_nat_prod_nat_nat</span> : <span class="id" title="var">iso</span> <span class="id" title="var">nat</span> (<span class="id" title="var">nat</span> * <span class="id" title="var">nat</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> := <span class="id" title="var">goto</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> := <span class="id" title="var">comefrom</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">comefrom_goto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">goto_comefrom</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1008"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">*</span> <span class="inlinecode"><span class="id" title="var">nat</span></span>, alternatywnie (TODO)</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">komenvan</span> (<span class="id" title="var">x</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">y</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">x</span> + <span class="id" title="var">y</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Nat.div2</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span> * <span class="id" title="var">n</span>) + <span class="id" title="var">y</span>.<br/>

<br/>
<span class="comment">(*&nbsp;ŹLE!<br/>
Function&nbsp;comefrom_v2&nbsp;(xy&nbsp;:&nbsp;nat&nbsp;*&nbsp;nat)&nbsp;{measure&nbsp;(fun&nbsp;'(x,&nbsp;y)&nbsp;=&gt;&nbsp;x&nbsp;+&nbsp;y)&nbsp;xy}&nbsp;:&nbsp;nat&nbsp;:=<br/>
match&nbsp;xy&nbsp;with<br/>
|&nbsp;(0,&nbsp;0)&nbsp;=&gt;&nbsp;0<br/>
|&nbsp;(x,&nbsp;y)&nbsp;=&gt;&nbsp;x&nbsp;+&nbsp;y&nbsp;+&nbsp;comefrom_v2&nbsp;(x&nbsp;-&nbsp;1,&nbsp;y&nbsp;-&nbsp;1)<br/>
end.<br/>
Proof.<br/>
&nbsp;&nbsp;-&nbsp;now&nbsp;intros&nbsp;<span class="inlinecode"></span>&nbsp;x&nbsp;y&nbsp;-&gt;&nbsp;y'&nbsp;-&gt;&nbsp;<span class="inlinecode">=</span> <span class="inlinecode">-&gt;</span> <span class="inlinecode">-&gt;</span>;&nbsp;cbn;&nbsp;lia.<br/>
&nbsp;&nbsp;-&nbsp;now&nbsp;intros&nbsp;<span class="inlinecode"><span class="id" title="var">x'</span></span> <span class="inlinecode"><span class="id" title="var">y'</span></span>&nbsp;x&nbsp;y&nbsp;n&nbsp;-&gt;&nbsp;<span class="inlinecode">=</span> <span class="inlinecode">-&gt;</span> <span class="inlinecode">-&gt;</span>;&nbsp;cbn;&nbsp;lia.<br/>
Defined.<br/>
<br/>
Compute&nbsp;comefrom&nbsp;(0,&nbsp;1).<br/>
Compute&nbsp;comefrom_v2&nbsp;(0,&nbsp;1).<br/>
Compute&nbsp;komenvan&nbsp;3&nbsp;5.<br/>
*)</span><br/>

<br/>
</div>

<div class="doc">
<a id="lab1009"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">nat</span></span></h2>

<div class="paragraph"> </div>

 Jak trudno jest z podstawowych izomorfizmów dla produktów i sum
    uskładać coś w stylu <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">nat</span></span>? A może nie da się i trzeba
    robić ręcznie? 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">nat_vec</span> {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">arg</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">vec</span> <span class="id" title="var">nat</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
| 0 =&gt; <span class="id" title="var">arg</span> :: <span class="id" title="var">vnil</span><br/>
| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">arg1</span>, <span class="id" title="var">arg2</span>) := <span class="id" title="var">goto</span> <span class="id" title="var">arg</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">arg1</span> :: <span class="id" title="var">nat_vec</span> <span class="id" title="var">arg2</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">vec_nat</span> {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">v</span> : <span class="id" title="var">vec</span> <span class="id" title="var">nat</span> <span class="id" title="var">n</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">v</span>} : <span class="id" title="var">option</span> <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">v</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">vnil</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">vcons</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">vec_nat</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">comefrom</span> (<span class="id" title="var">h</span>, <span class="id" title="var">r</span>))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>]<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">vec_S</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">iso</span> (<span class="id" title="var">vec</span> <span class="id" title="var">A</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)) (<span class="id" title="var">A</span> * <span class="id" title="var">vec</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">coel</span> <span class="id" title="var">v</span> := (<span class="id" title="var">head</span> <span class="id" title="var">v</span>, <span class="id" title="var">tail</span> <span class="id" title="var">v</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">coer</span> '(<span class="id" title="var">h</span>, <span class="id" title="var">t</span>) := <span class="id" title="var">vcons</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span> <span class="id" title="var">vcons</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>); <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">v</span>]; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_nat_vlist_S</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iso</span> <span class="id" title="var">nat</span> (<span class="id" title="var">vec</span> <span class="id" title="var">nat</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">coel</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">vcons</span> <span class="id" title="var">n</span> <span class="id" title="var">vnil</span>) (<span class="id" title="var">coer</span> := <span class="id" title="var">head</span>); [<span class="id" title="var">easy</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span> <span class="id" title="var">vcons</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">f_equal</span>; [| <span class="id" title="var">easy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">match</span> <span class="id" title="var">v</span> <span class="id" title="keyword">with</span> <span class="id" title="var">vnil</span> =&gt; <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">iso_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_nat_prod_nat_nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">iso_trans</span>; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_sym</span>, <span class="id" title="var">vec_S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_pres_prod</span>; [| <span class="id" title="var">easy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_refl</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_vlist_option</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iso</span> (<span class="id" title="var">vlist</span> <span class="id" title="var">A</span>) (<span class="id" title="var">option</span> {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span> &amp; <span class="id" title="var">vec</span> <span class="id" title="var">A</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">esplit</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [[| <span class="id" title="var">n</span>] <span class="id" title="var">v</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> <span class="id" title="var">None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">existT</span> <span class="id" title="var">_</span> <span class="id" title="var">n</span> <span class="id" title="var">v</span>)).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [[<span class="id" title="var">n</span> <span class="id" title="var">v</span>] |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">existT</span> <span class="id" title="var">_</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">existT</span> <span class="id" title="var">_</span> 0 <span class="id" title="var">vnil</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [? []].<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [[] |].<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">iso_nat_list_nat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">iso</span> <span class="id" title="var">nat</span> (<span class="id" title="var">list</span> <span class="id" title="var">nat</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">iso_trans</span>; [| <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_sym</span>, <span class="id" title="var">iso_list_vlist</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">vlist</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">iso_trans</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_nat_option_nat</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">iso_trans</span>; [| <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_sym</span>, <span class="id" title="var">iso_vlist_option</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">iso_pres_option</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">iso_trans</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_nat_prod_nat_nat</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">iso_sym</span>, <span class="id" title="var">iso_sigT_prod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">iso_sym</span>, <span class="id" title="var">iso_nat_vlist_S</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Compute&nbsp;D5a.map&nbsp;(coel&nbsp;iso_nat_list_nat)&nbsp;(D5a.iterate&nbsp;S&nbsp;100&nbsp;0).&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
... ale <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">~</span> <span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">nat</span></span> jest dość trudne. </div>
<div class="code">
</div>
