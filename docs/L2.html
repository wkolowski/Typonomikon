<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="coqdoc.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery-3.5.1.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="MyStyles.js"></script>
</head>
<h1 class="libtitle">L2: Kontynuacje i kontrola [TODO]</h1>

<div class="code">
</div>

<div class="doc">

</div>
<div class="code">

<br/>

<br/>
</div>

<div class="doc">
<a id="lab823"></a><h1 class="section">Wstęp</h1>

<div class="paragraph"> </div>

 Chyba właśnie zrozumiałem, o co chodzi z kontynuacjami.
    Przykład wzięty z
    https://legacy-cs.sice.indiana.edu/~sabry/papers/yield.pdf
    sekcja 3.

<div class="paragraph"> </div>

    Oświecająca muzyka: https://www.youtube.com/watch?v=-N4jf6rtyuw 
<div class="paragraph"> </div>

 Przyjrzyjmy się paru przykładowym funkcjom na niepustych drzewach
    binarnych, które wartości trzymają w liściach. Gry słowne: ciekawe,
    gdzie trzymają antywartości... :) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Tree</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Leaf</span> (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) | <span class="id" title="var">Node</span> (<span class="id" title="var">l</span> <span class="id" title="var">r</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>).<br/>

<br/>
</div>

<div class="doc">
Nota bene: taki skrócony zapis powoduje, że przy użyciu <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>
    i <span class="inlinecode"><span class="id" title="tactic">induction</span></span> Coq będzie nadawał zmiennym domyślnie nazwy <span class="inlinecode"><span class="id" title="var">x</span></span>, <span class="inlinecode"><span class="id" title="var">l</span></span>,
    <span class="inlinecode"><span class="id" title="var">r</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">Leaf</span> {<span class="id" title="var">A</span>} <span class="id" title="var">_</span>.<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">Node</span> {<span class="id" title="var">A</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
Na pierwszy ogień - jak powiększyć liczbę w każdym liściu o <span class="inlinecode">1</span>? 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">renum</span> (<span class="id" title="var">t</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">nat</span>) : <span class="id" title="var">Tree</span> <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">Leaf</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">Node</span> (<span class="id" title="var">renum</span> <span class="id" title="var">l</span>) (<span class="id" title="var">renum</span> <span class="id" title="var">r</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Cóż, łatwo. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Tree</span> <span class="id" title="var">B</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">Leaf</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">Node</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>) (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">r</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Łatwo będzie też pokazać, że <span class="inlinecode"><span class="id" title="var">renum</span></span> działa tak samo jak mapowanie
    następnika. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">renum_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">renum</span> <span class="id" title="var">t</span> = <span class="id" title="var">map</span> <span class="id" title="var">S</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n</span> | <span class="id" title="var">l</span> <span class="id" title="var">IHl</span> <span class="id" title="var">r</span> <span class="id" title="var">IHr</span>]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>, <span class="id" title="var">IHr</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Celem powyższego było pokazanie, że nie należy kontynuacji wpychać
    wszędzie, bo niektóre rzeczy da się zrobić bez nich.

<div class="paragraph"> </div>

    Idąc dalej napotykamy następujacy problem: dla dwóch drzew <span class="inlinecode"><span class="id" title="var">t1</span></span> i
    <span class="inlinecode"><span class="id" title="var">t2</span></span> sprawdź, czy mają takie same grzywki. Grzywka drzewa to lista
    jego liści w kolejności występowania (być może słowo "korona" lepiej
    pasowałoby do drzew, ale cóż, epidemia...).

<div class="paragraph"> </div>

    Prymitywny pomysł może wyglądać tak: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">same_fringe</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">cmp</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t1</span>, <span class="id" title="var">t2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">x</span>    , <span class="id" title="var">Leaf</span> <span class="id" title="var">y</span>     =&gt; <span class="id" title="var">cmp</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l1</span> <span class="id" title="var">r1</span>, <span class="id" title="var">Node</span> <span class="id" title="var">l2</span> <span class="id" title="var">r2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">same_fringe</span> <span class="id" title="var">cmp</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> &amp;&amp; <span class="id" title="var">same_fringe</span> <span class="id" title="var">cmp</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Oczywiście jest źle, bo powyższe zwraca <span class="inlinecode"><span class="id" title="var">false</span></span> dla drzew o różnych
    kształtach, a przecież drzewa o różnych kształtach mogą mieć takie
    same grzywki.

<div class="paragraph"> </div>

    Nowy pomysł: zróbmy to, co mówi specyfikacja, i po prostu policzmy
    dla drzewa jego grzywkę. Potem porównamy grzywki i gitara. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">fringe</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">x</span> =&gt; [<span class="id" title="var">x</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">fringe</span> <span class="id" title="var">l</span> ++ <span class="id" title="var">fringe</span> <span class="id" title="var">r</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Cytując definicję: grzywka drzewa to lista jego liści, po kolei. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">zipWith</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">la</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">lb</span> : <span class="id" title="var">list</span> <span class="id" title="var">B</span>) : <span class="id" title="var">list</span> <span class="id" title="var">C</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">la</span>, <span class="id" title="var">lb</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [], [] =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">a</span> :: <span class="id" title="var">la'</span>, <span class="id" title="var">b</span> :: <span class="id" title="var">lb'</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> :: <span class="id" title="var">zipWith</span> <span class="id" title="var">f</span> <span class="id" title="var">la'</span> <span class="id" title="var">lb'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; []<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">all</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">bool</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">h</span> :: <span class="id" title="var">t</span> =&gt; <span class="id" title="var">h</span> &amp;&amp; <span class="id" title="var">all</span> <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Przydadzą się podstawowe funkcje na listach, których biedacka
    biblioteka standardowa nie ma. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">same_fringe2</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">cmp</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span> (<span class="id" title="var">zipWith</span> <span class="id" title="var">cmp</span> (<span class="id" title="var">fringe</span> <span class="id" title="var">t1</span>) (<span class="id" title="var">fringe</span> <span class="id" title="var">t2</span>)).<br/>

<br/>
</div>

<div class="doc">
Znów jak w specyfikacji: policz grzywki, sprawdź czy każdy liść jest
    taki sam, a potem, czy wszystkie porównania się powiodły. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Arith</span>.<br/>

<br/>
<span class="id" title="keyword">Let</span> <span class="id" title="var">t1</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Node</span> (<span class="id" title="var">Leaf</span> 5) (<span class="id" title="var">Leaf</span> 12))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 42).<br/>

<br/>
<span class="id" title="keyword">Let</span> <span class="id" title="var">t2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 5)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Node</span> (<span class="id" title="var">Leaf</span> 12) (<span class="id" title="var">Leaf</span> 42)).<br/>

<br/>
</div>

<div class="doc">
Dane testowe. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">same_fringe</span>  <span class="id" title="var">beq_nat</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>.<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">same_fringe2</span> <span class="id" title="var">beq_nat</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>.<br/>

<br/>
</div>

<div class="doc">
Jak widać, pierwsze podejście było złe, a drugie jest dobre.
    Ćwiczenie: udowodnij.

<div class="paragraph"> </div>

    My tutaj jednak nie o tym. Powyższe dumania pokazują, że wciąż nie
    potrzeba tu żadnych kontynuacji. Czas zatem zmierzyć się z problemem,
    gdzie są one nieuniknione (lub jestem za głupi, żeby znać jakieś inne
    rozwiązanie).

<div class="paragraph"> </div>

    Zadanie: napisz funkcję, która bierze drzewa <span class="inlinecode"><span class="id" title="var">t1</span></span> i <span class="inlinecode"><span class="id" title="var">t2</span></span> i zamienia
    ich grzywki, zachowując rzecz jasna kształty drzew.

<div class="paragraph"> </div>

    Poświęc kilka minut, żeby spróbować rozwiązać to zadanie. Ja, gdy
    zobaczyłem je w zalinkowanej powyżej pracy, natychmiast zdałem sobie
    sprawę, że nie znam żadnego prostego sposobu, żeby to zrobić i wtedy
    właśnie doznałem oświecenia - kontynuacje jednak nie są ezoteryczne,
    są przydatne i nawet można je sobie wyobrazić (o tym później).

<div class="paragraph"> </div>

    Jeśli już przekonałeś się, że nie umiesz rozwiązać zadania, czas
    zobaczyć rozwiązanie! 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Iterator</span> (<span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Result</span> : <span class="id" title="var">R</span> -&gt; <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Susp</span>   : <span class="id" title="var">O</span> -&gt; (<span class="id" title="var">I</span> -&gt; <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R</span>) -&gt; <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R</span>.<br/>

<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">Result</span> {<span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R</span>} <span class="id" title="var">_</span>.<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">Susp</span>   {<span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
A rozwiązanie jest takie. Jeżeli próbujemy łazić po drzewie zwykłą
    funkcją i kombinować coś z grzywką, to mamy problem, bo przepływ
    sterowania w takiej funkcji jest całkowicie implicitny - nie mamy
    nad nim żadnej kontroli.

<div class="paragraph"> </div>

    Pomysł jest więc taki, żeby tę kontrolę sobie dać, reifikując ideę
    "przejścia po grzywce" przez zdefiniowanie nowego typu induktywnego.
    Temu właśnie służy rodzina typów <span class="inlinecode"><span class="id" title="var">Iterator</span></span>. Nazwa jest wzięta z
    zalinkowanej pracy - w naszym przypadku dużo lepszą nazwą byłoby po
    prostu coś w stylu <span class="inlinecode"><span class="id" title="var">FringeWalk</span></span>, co na naszą mowę ojczystą możemy
    przłożyć jako "spacerek po grzywce".

<div class="paragraph"> </div>

    Nasz spacerek po grzywce ma nastepującą strukturę:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">Result</span></span> reprezentuje koniec spacerku, zaś jego argument to wynik.
      Chcemy, żeby spacerek dawał wynik, bo inaczej byłby bezproduktywny.
      <span class="inlinecode"><span class="id" title="var">R</span></span> to typ wyniku spacerku.

</li>
<li> <span class="inlinecode"><span class="id" title="var">Susp</span></span> reprezentuje przerwę w spacerku - kiedy się zmęczymy,
      chcemy móc sobie przystanąć. Oczywiście dziwnym zbiegiem
      okoliczności zawsze będziemy "przystawać sobie", kiedy natrafimy
      na liść.

</li>
</ul>

<div class="paragraph"> </div>

    Spacerek nie składa się jednak tylko z przystanków i końcowego wyniku.
    Mamy też argumenty <span class="inlinecode"><span class="id" title="var">I</span></span> oraz <span class="inlinecode"><span class="id" title="var">O</span></span>, które są typami wejścia i wyjścia -
    kiedy już zatrzymamy się w liściu, będziemy chcieli zwrócić zastaną
    tam wartość. Właśnie do tego służy pierwszy argument konstruktora
    <span class="inlinecode"><span class="id" title="var">Susp</span></span>, który ma typ <span class="inlinecode"><span class="id" title="var">O</span></span>. Inna sprawa jest taka, że gdy już wyjmiemy
    wartość z liścia, będziemy musieli wsadzić tam jakąś inną wartość,
    zanim będziemy mogli kontynuować spacerek. Właśnie to wyraża drugi
    argument konstruktora <span class="inlinecode"><span class="id" title="var">Susp</span></span>, o typie <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">Iterator</span></span> <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span>: jeżeli
    dostaniemy na wejściu jakąś wartość typu <span class="inlinecode"><span class="id" title="var">I</span></span>, wsadzamy ją do pustego
    liścia, po czym kontynuujemy spacerek.

<div class="paragraph"> </div>

    Wyposażeni w tak potężną reprezentacją spacerków po grzywce możemy
    przejść już do tego, co tygryski lubią najbardziej, czyż nie? No
    jeszcze nie. Najpierw garść funkcji pomocniczych (gdybyś jakimś
    cudem nie zauważył, to <span class="inlinecode"><span class="id" title="var">Iterator</span></span> <span class="inlinecode"><span class="id" title="var">I</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> jest monadą; jeżeli nie wiesz
    co to jest monada - cóż, monady są jak koronawirusy...). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">yield</span> {<span class="id" title="var">I</span> <span class="id" title="var">O</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">O</span>) : <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">I</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Susp</span> <span class="id" title="var">x</span> <span class="id" title="var">Result</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">yield</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> to jednoprzystankowy spacerek, którego wynikiem jest to,
    co dostaniemy na wejściu. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">bindI</span> {<span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R1</span> <span class="id" title="var">R2</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R1</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">R1</span> -&gt; <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R2</span>) : <span class="id" title="var">Iterator</span> <span class="id" title="var">I</span> <span class="id" title="var">O</span> <span class="id" title="var">R2</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">i</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Result</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Susp</span> <span class="id" title="var">o</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">Susp</span> <span class="id" title="var">o</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="var">bindI</span> (<span class="id" title="var">k</span> <span class="id" title="var">i</span>) <span class="id" title="var">f</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">bindI</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> to składanie spacerków - najpierw spacerujemy spacerkiem
    <span class="inlinecode"><span class="id" title="var">i</span></span>, a potem spacerkiem <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">r</span></span>, gdzie <span class="inlinecode"><span class="id" title="var">r</span></span> jest wynikiem spacerku <span class="inlinecode"><span class="id" title="var">i</span></span>.
    Jak więc widać, trasa drugiego spacerku może zależeć od wyniku
    pierwszego spacerku - zupełnie jak w życiu!

<div class="paragraph"> </div>

    Dobra, tyle pomocnicznych funkcji powinno wystarczyć. Czas przejść
    do sedna, czyli zamiany grzywek. Zacznijmy od napisania funkcji,
    która przekształca drzewo <span class="inlinecode"><span class="id" title="var">t</span></span> w spacerek po grzywce <span class="inlinecode"><span class="id" title="var">t</span></span>. Spacerek
    będzie depth-first, od lewej do prawej, czyli dość standardowy. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">depthWalk</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Iterator</span> <span class="id" title="var">B</span> <span class="id" title="var">A</span> (<span class="id" title="var">Tree</span> <span class="id" title="var">B</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Leaf</span> <span class="id" title="var">a</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bindI</span> (<span class="id" title="var">yield</span> <span class="id" title="var">a</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">Result</span> (<span class="id" title="var">Leaf</span> <span class="id" title="var">b</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Node</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bindI</span> (<span class="id" title="var">depthWalk</span> <span class="id" title="var">l</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">l'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bindI</span> (<span class="id" title="var">depthWalk</span> <span class="id" title="var">r</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">r'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Result</span> (<span class="id" title="var">Node</span> <span class="id" title="var">l'</span> <span class="id" title="var">r'</span>)))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Szczo wyrablajesja tut? Ano, już tłumaczę.

<div class="paragraph"> </div>

    Po pierwsze, spróbujmy przeczytać typ. Funkcja <span class="inlinecode"><span class="id" title="var">depthWalk</span></span> bierze
    jako argument drzewo <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Tree</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> i zamienia je w spacerek po 
    grzywce <span class="inlinecode"><span class="id" title="var">t</span></span>, którego wynikiem jest drzewo o typie <span class="inlinecode"><span class="id" title="var">Tree</span></span> <span class="inlinecode"><span class="id" title="var">B</span></span>, czyli
    potencjalnie innym, niż. Wynika to z tego, że podczas spacerku
    będziemy dostawać na wejściu wartości typu <span class="inlinecode"><span class="id" title="var">B</span></span>, podczas gdy na
    wyjściu dajemy wartościu typu <span class="inlinecode"><span class="id" title="var">A</span></span>.

<div class="paragraph"> </div>

    Nieco inne spojrzenie może być takie, że wynikiem <span class="inlinecode"><span class="id" title="var">depthWalk</span></span> jest
    drzewo <span class="inlinecode"><span class="id" title="var">t</span></span> z wyznaczoną trasą spacerku po grzywce, a wynikiem samego
    spacerku będzie to, co z <span class="inlinecode"><span class="id" title="var">t</span></span> zostanie po zabraniu grzywki i
    zastąpieniu jej wartościami z wejścia.

<div class="paragraph"> </div>

    Sama funkcja działa natomiast następująco.

<div class="paragraph"> </div>

    Gdy napotkamy liść z wartością <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">A</span></span>, oddajemy je na wyjście i
    w zamian dostajemy wartość <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">B</span></span>. Wynikiem spacerku jest <span class="inlinecode"><span class="id" title="var">b</span></span>
    zapakowane w liść (pamiętaj, że próbujemy przekształcić drzewo na
    spacerek po grzywce).

<div class="paragraph"> </div>

    Gdy napotkamy węzeł wewnętrzny, najpierw zamieniamy lewe poddrzewo,
    zwane <span class="inlinecode"><span class="id" title="var">l</span></span>, w spacerek po lewym poddrzewie, zwany <span class="inlinecode"><span class="id" title="var">l'</span></span>. Podobnie
    prawe poddrzewo <span class="inlinecode"><span class="id" title="var">r</span></span> zamieniamy na spacerek po prawym poddrzewie <span class="inlinecode"><span class="id" title="var">r'</span></span>.
    Następnie sklejamy spacerki, a ostatecznym wynikiem tak sklejonego
    spacerku to samo drzewo co na początku, tylko z grzywką zastąpioną
    przez wartości z wejścia.

<div class="paragraph"> </div>

    Dobra, jesteśmy już nieźle ustawieni. Jeżeli nie nadążasz, to dla
    spowolnienia tempa odłóżmy na chwilę funkcję zamieniającą grzywki
    i spróbujmy napisać kolejne wcielenie funkcji porównującej grzywki.

<div class="paragraph"> </div>

    Sprawa jest banalna: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">same_fringe_aux</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">R</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">cmp</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> : <span class="id" title="var">Iterator</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">t1</span>, <span class="id" title="var">t2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Susp</span> <span class="id" title="var">x</span> <span class="id" title="var">k</span>, <span class="id" title="var">Susp</span> <span class="id" title="var">y</span> <span class="id" title="var">h</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cmp</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> &amp;&amp; <span class="id" title="var">same_fringe_aux</span> <span class="id" title="var">cmp</span> (<span class="id" title="var">k</span> <span class="id" title="var">x</span>) (<span class="id" title="var">h</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Result</span> <span class="id" title="var">_</span>, <span class="id" title="var">Result</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Nasza funkcja odbywa jednocześnie dwa spacerki: pierwszy po <span class="inlinecode"><span class="id" title="var">t1</span></span>,
    a drugi po <span class="inlinecode"><span class="id" title="var">t2</span></span>.

<div class="paragraph"> </div>

    Jeżeli w obu spacerkach jesteśmy na przystanku, to porównujemy
    znalezione tam wartości za pomocą <span class="inlinecode"><span class="id" title="var">cmp</span></span> i kontynuujemy spacerek.
    Kontynuacją spacerka <span class="inlinecode"><span class="id" title="var">Susp</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> jest <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> - wartość z liścia,
    czyli <span class="inlinecode"><span class="id" title="var">x</span></span>, musimy w tym celu odłożyć na swoje miejsce, czyli
    przekazać ją do <span class="inlinecode"><span class="id" title="var">k</span></span>. Analogicznie dla <span class="inlinecode"><span class="id" title="var">y</span></span> i <span class="inlinecode"><span class="id" title="var">h</span></span>.

<div class="paragraph"> </div>

    Jeżeli doszliśmy do końca spacerka, to grzywki są takie same.
    Dlaczego tak? Cóż, pamiętaj, że wartości z liści są w przystankach,
    więc skoro doszliśmy do końca i wszystkie porównania się udały, to
    grzywki musiały być takie same.

<div class="paragraph"> </div>

    Jeżeli zaś mamy inny przypadek, czyli z jednej strony przystanek, a
    z drugiej koniec lub na odwrót, zwracamy <span class="inlinecode"><span class="id" title="var">false</span></span>, gdyż znaczy to, że
    grzywki mają różną długość, czyli nie mogą być takie same. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">same_fringe3</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">cmp</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>) (<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">same_fringe_aux</span> <span class="id" title="var">cmp</span> (<span class="id" title="var">depthWalk</span> <span class="id" title="var">t1</span>) (<span class="id" title="var">depthWalk</span> <span class="id" title="var">t2</span>).<br/>

<br/>
</div>

<div class="doc">
Całość pakujemy w funkcję pomocniczą, która jako argumenty bierze
    drzewa, przerabia je na spacerki i przekazuje te spacerki do wyżej
    zdefiniowanej funkcji pomocniczej. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">same_fringe3</span> <span class="id" title="var">beq_nat</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>.<br/>

<br/>
</div>

<div class="doc">
Działa jak marzenie! Ćwiczenie: udowodnij.

<div class="paragraph"> </div>

    Jak widać, kontynuacje mają potężną moc. Dzięki przekształceniu
    drzewa w spacerek po grzywce możemy zdefiniować porównywanie
    grzywek <span class="inlinecode"><span class="id" title="var">same_fringe_aux</span></span> w dokładnie taki sposób, jak próbowaliśmy
    na początku (<span class="inlinecode"><span class="id" title="var">same_fringe</span></span>), ale teraz to działa, a wtedy nie.
    Różnica wynika stąd, że o ile drzewa mogą różnić się kształtami, o
    tyle ich grzywki mogą się co najwyżej różnić długością.

<div class="paragraph"> </div>

    No, ale powstrzymajmy zachwyt, bo bez kontynuacji też nam się
    udało. Zobaczmy teraz, jak kontynuacje radzą sobie z problemem
    zamiany grzywek. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">swap_fringe_aux</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> : <span class="id" title="var">Iterator</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span> (<span class="id" title="var">Tree</span> <span class="id" title="var">A</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="var">option</span> (<span class="id" title="var">Tree</span> <span class="id" title="var">A</span> * <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">i1</span>, <span class="id" title="var">i2</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Susp</span> <span class="id" title="var">x</span> <span class="id" title="var">k</span>, <span class="id" title="var">Susp</span> <span class="id" title="var">y</span> <span class="id" title="var">h</span> =&gt; <span class="id" title="var">swap_fringe_aux</span> (<span class="id" title="var">k</span> <span class="id" title="var">y</span>) (<span class="id" title="var">h</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Result</span> <span class="id" title="var">t1</span>, <span class="id" title="var">Result</span> <span class="id" title="var">t2</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">t1</span>, <span class="id" title="var">t2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">swap_fringe_aux</span></span> to funkcje, która bierze jako argumenty dwa
    spacerki, których wynikami są drzewa, i zwraca parę drzew, gdzie
    pierwsze to wynik pierwszego spacerku, ale z grzywką wziętą z
    drugiego spacerku i vice versa. Jeżeli grzywki mają różną długość,
    wynikiem będzie <span class="inlinecode"><span class="id" title="var">None</span></span>, stąd w typie pojawia się <span class="inlinecode"><span class="id" title="var">option</span></span>.

<div class="paragraph"> </div>

    Funkcja działa tak: spacerujemy jednocześnie po obu grzywkach.
    Jeżeli natykamy się jednocześnie na dwa przystanki, pierwszy z
    wartością <span class="inlinecode"><span class="id" title="var">x</span></span> i kontynuacją <span class="inlinecode"><span class="id" title="var">k</span></span>, a drugi z wartością <span class="inlinecode"><span class="id" title="var">y</span></span> i
    kontynuacją <span class="inlinecode"><span class="id" title="var">h</span></span>, to do pierwszej grzywki wrzucamy wartość z
    drugiej grzywki, a do drugiej grzywki wrzucamy wartość z pierwszej
    grzywki, po czym spacerujemy dalej.

<div class="paragraph"> </div>

    Jeżeli jednocześnie oba spacery się kończą, zwracamy parę drzew,
    które są wynikami spacerów. Jeżeli pierwszy spacer się skończył
    a drugi nie lub na odwrót, to znaczy, że grzywki mają różne długości,
    więc zwracamy <span class="inlinecode"><span class="id" title="var">None</span></span>.

<div class="paragraph"> </div>

    Gdybyś się zagubił, przeżyjmy to jeszcze raz:
<ul class="doclist">
<li> w pierwszym spacerku wyjściem są wartości z pierwszej grzywki,
      wejściem są wartości z drugiej grzywki, a wynikiem pierwsze
      drzewo z drugą grzywką

</li>
<li> w drugim spacerku wyjściem są wartości z drugiej grzywki, wejściem
      są wartości z pierwszej grzywki, a wynikiem jest drugie drzewo z
      pierwszą grzywką

</li>
</ul>

<div class="paragraph"> </div>

    Geniuszalne, prawda? 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap_fringe</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> : <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">Tree</span> <span class="id" title="var">A</span> * <span class="id" title="var">Tree</span> <span class="id" title="var">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">swap_fringe_aux</span> (<span class="id" title="var">depthWalk</span> <span class="id" title="var">t1</span>) (<span class="id" title="var">depthWalk</span> <span class="id" title="var">t2</span>).<br/>

<br/>
</div>

<div class="doc">
Pozostaje nam tylko napisać właściwą funkcję, która jest owijką na
    funkcję pomocniczą: bierze ona dwa drzewa, przekształca na spacerki
    za pomocą <span class="inlinecode"><span class="id" title="var">depthWalk</span></span> i przekazuje do <span class="inlinecode"><span class="id" title="var">swap_fringe_aux</span></span>, która robi
    całą robotę. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Let</span> <span class="id" title="var">t1'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 3)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 4))).<br/>

<br/>
<span class="id" title="keyword">Let</span> <span class="id" title="var">t2'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Node</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 11)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 12))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 13))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Leaf</span> 14).<br/>

<br/>
</div>

<div class="doc">
A oto nowe przykładowe dane: pierwsze drzewo jest przechylone w
    prawo, a drugie w lewo. Wartości w obu drzewach są różne.
    (Poprzednie przykładowe drzewa się nie nadają, bo o ile miały różne
    kształty, to wartości w liściach miały takie same). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">swap_fringe</span> <span class="id" title="var">t1'</span> <span class="id" title="var">t2'</span>.<br/>
<span class="comment">(*&nbsp;===&gt;<br/>
&nbsp;&nbsp;=&nbsp;Some<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Node&nbsp;(Leaf&nbsp;11)&nbsp;(Node&nbsp;(Leaf&nbsp;12)&nbsp;(Node&nbsp;(Leaf&nbsp;13)&nbsp;(Leaf&nbsp;14))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&nbsp;(Node&nbsp;(Node&nbsp;(Leaf&nbsp;1)&nbsp;(Leaf&nbsp;2))&nbsp;(Leaf&nbsp;3))&nbsp;(Leaf&nbsp;4))<br/>
&nbsp;&nbsp;:&nbsp;option&nbsp;(Tree&nbsp;nat&nbsp;*&nbsp;Tree&nbsp;nat)&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Wynik jest trochę nieczytelny ze względu na formatowanie, ale stało
    się dokładnie to, czego sobie życzyliśmy: wynikiem jest para drzew,
    z czego pierwsze jest pochylone w prawo, jak to wejściowe, ale jego
    grzywka ma wartości z drugiego drzewa wejściowego. Drugie drzewo z
    pary analogicznie: jest pochylone w lewo, jak drugie drzewo z wejścia,
    ale jego grzywka ma wartości z pierwszego drzewa wejściowego.

<div class="paragraph"> </div>

    No, możemy odbębnić sukces, czyż nie? Nie do końca, bo wypadałoby
    jeszcze wyjaśnić dwie sprawy. Po pierwsze, jak można wyobrazić
    sobie spacerek?

<div class="paragraph"> </div>

    Żeby odpowiedzieć na to pytanie, zobaczmy jak wygląda spacerek
    po grzywce przykładowego drzewa <span class="inlinecode"><span class="id" title="var">t1'</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">depthWalk</span> <span class="id" title="var">t1'</span>.<br/>
<span class="comment">(*&nbsp;===&gt;<br/>
=&nbsp;Susp&nbsp;1<br/>
&nbsp;&nbsp;&nbsp;(fun&nbsp;x&nbsp;:&nbsp;?B&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Susp&nbsp;2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;x0&nbsp;:&nbsp;?B&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Susp&nbsp;3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;x1&nbsp;:&nbsp;?B&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Susp&nbsp;4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fun&nbsp;x2&nbsp;:&nbsp;?B&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Node&nbsp;(Leaf&nbsp;x)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Node&nbsp;(Leaf&nbsp;x0)&nbsp;(Node&nbsp;(Leaf&nbsp;x1)&nbsp;(Leaf&nbsp;x2))))))))<br/>
:&nbsp;Iterator&nbsp;?B&nbsp;nat&nbsp;(Tree&nbsp;?B)&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Moim zdaniem odpowiedź jest całkiem czytelna. Spacerek wygląda tak,
    że stąpamy po kolejnych liściach, wyrzucamy ich wartości na wyjście,
    zbierając przy tym wartości z wejścia, a na koniec zwracamy drzewo
    z grzywką podmienioną wartościami wejściowymi. Oczywiście po węzłach
    wewnętrznych też przechodzimy, co widać w implementacji, ale nie
    interesują nas one, więc się w nich nie zatrzymujemy i dlatego tych
    kroków tutaj nie widać. Ćwiczenie: narysuj ładny obrazek.

<div class="paragraph"> </div>

    Pozostaje zatem pytanie ostateczne: co to są kontynuacje? Gdzie
    występują one w naszym rozwiązaniu i jak się przejawiają? Cóż,
    korzystając ze świętego prawa pisarza matematycznego, odpowiedź
    na to pytanie pozostawiam czytelnikowi jako ćwiczenie. 
<div class="paragraph"> </div>

<a id="lab824"></a><h1 class="section">Defunkcjonalizacja (TODO)</h1>

<div class="paragraph"> </div>

<a id="lab825"></a><h2 class="section">Defunkcjonalizacja filtrowania (TODO)</h2>

<div class="paragraph"> </div>

 Bardzo insajtowy filmik (i transkrypcjo-artykuł) o defunkcjonalizacji
    (i refunkcjonalizacji też):

<div class="paragraph"> </div>

http://www.pathsensitive.com/2019/07/the-best-refactoring-youve-never-heard.html
https://blog.sigplan.org/2019/12/30/defunctionalization-everybody-does-it-nobody-talks-about-it/

<div class="paragraph"> </div>

    Ok, o co chodzi? 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">D5</span>.<br/>

<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">filter</span>.<br/>
<span class="comment">(*&nbsp;===&gt;&nbsp;filter&nbsp;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;(A&nbsp;:&nbsp;Type)&nbsp;(p&nbsp;:&nbsp;A&nbsp;-&gt;&nbsp;bool)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fix&nbsp;filter&nbsp;(l&nbsp;:&nbsp;list&nbsp;A)&nbsp;{struct&nbsp;l}&nbsp;:&nbsp;list&nbsp;A&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;l&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span class="inlinecode"></span>&nbsp;=&gt;&nbsp;<span class="inlinecode"></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;h&nbsp;::&nbsp;t&nbsp;=&gt;&nbsp;if&nbsp;p&nbsp;h&nbsp;then&nbsp;h&nbsp;::&nbsp;filter&nbsp;t&nbsp;else&nbsp;filter&nbsp;t<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;forall&nbsp;A&nbsp;:&nbsp;Type,&nbsp;(A&nbsp;-&gt;&nbsp;bool)&nbsp;-&gt;&nbsp;list&nbsp;A&nbsp;-&gt;&nbsp;list&nbsp;A&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Przyjrzyjmy się funkcji <span class="inlinecode"><span class="id" title="var">filter</span></span> (w nieco zmodyfikowanej wersji -
    potrafisz powiedzieć, czym różni się ona od tej z rozdziału o
    listach?). Jest to prosta funkcja, która wyrzuca z listy elementy,
    które nie spełniają predykatu <span class="inlinecode"><span class="id" title="var">p</span></span>.

<div class="paragraph"> </div>

    I cóż, że ze Szwecji? Ano, jest pewna kolosalna różnica między
    funkcją <span class="inlinecode"><span class="id" title="var">filter</span></span>, którą znamy z Coqa, oraz filtrami, które
    znamy z różnych programów czy stron internetowych: argumentem
    <span class="inlinecode"><span class="id" title="var">filter</span></span> jest predykat boolowski, ale filtrowania w rzeczywistym
    świecie mają zazwyczaj charakter zaznaczenia jakiegoś checkboxa
    w stylu "tylko ze zdjęciem" czy wybrania zakresu cen/ocen. Żadne
    rzeczywistoświatowe filtrowanie raczej nie pozwali nam podać
    predykatu boolowskiego. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">MyFilter</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">IsEven</span> : <span class="id" title="var">MyFilter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LessThan</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">MyFilter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LifeUniverseAndAllThat</span> : <span class="id" title="var">MyFilter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">And</span> : <span class="id" title="var">MyFilter</span> -&gt; <span class="id" title="var">MyFilter</span> -&gt; <span class="id" title="var">MyFilter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Or</span> : <span class="id" title="var">MyFilter</span> -&gt; <span class="id" title="var">MyFilter</span> -&gt; <span class="id" title="var">MyFilter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Not</span> : <span class="id" title="var">MyFilter</span> -&gt; <span class="id" title="var">MyFilter</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">apply</span> (<span class="id" title="var">p</span> : <span class="id" title="var">MyFilter</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">bool</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">IsEven</span> =&gt; <span class="id" title="var">even</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LessThan</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">n</span> &lt;? <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">LifeUniverseAndAllThat</span> =&gt; <span class="id" title="var">n</span> =? 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">And</span> <span class="id" title="var">p1</span> <span class="id" title="var">p2</span> =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">p1</span> <span class="id" title="var">n</span> &amp;&amp; <span class="id" title="tactic">apply</span> <span class="id" title="var">p2</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Or</span> <span class="id" title="var">p1</span> <span class="id" title="var">p2</span> =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">p1</span> <span class="id" title="var">n</span> || <span class="id" title="tactic">apply</span> <span class="id" title="var">p2</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Not</span> <span class="id" title="var">p'</span> =&gt; <span class="id" title="var">negb</span> (<span class="id" title="tactic">apply</span> <span class="id" title="var">p'</span> <span class="id" title="var">n</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab826"></a><h2 class="section">Defunkcjonalizacja silni (TODO)</h2>

<div class="paragraph"> </div>

 Wzięte z https://ncatlab.org/nlab/show/defunctionalization 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">fac</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">n</span> * <span class="id" title="var">fac</span> <span class="id" title="var">n'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">fac</span> 5.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">facCPS</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" title="var">k</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">facCPS</span> <span class="id" title="var">n'</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="var">k</span> (<span class="id" title="var">n</span> * <span class="id" title="var">r</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">facCPS</span> 5 (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">n</span>).<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">DefunNatNat</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Id</span> : <span class="id" title="var">DefunNatNat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Mul</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">DefunNatNat</span> -&gt; <span class="id" title="var">DefunNatNat</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">eval</span> (<span class="id" title="var">k</span> : <span class="id" title="var">DefunNatNat</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">k</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Id</span> =&gt; <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Mul</span> <span class="id" title="var">r</span> <span class="id" title="var">k'</span> =&gt; <span class="id" title="tactic">eval</span> <span class="id" title="var">k'</span> (<span class="id" title="var">r</span> * <span class="id" title="var">n</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="tactic">eval</span> (<span class="id" title="var">Mul</span> 5 <span class="id" title="var">Id</span>) 1.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">facCPSDefun</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">DefunNatNat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">facCPSDefun</span> <span class="id" title="var">n'</span> (<span class="id" title="var">Mul</span> <span class="id" title="var">n</span> <span class="id" title="var">k</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">facCPSDefun</span> 5 <span class="id" title="var">Id</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">facCPS_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">facCPS</span> <span class="id" title="var">n</span> <span class="id" title="var">k</span> = <span class="id" title="var">k</span> (<span class="id" title="var">fac</span> <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span>]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn'</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">facCPSDefun_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">DefunNatNat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">facCPSDefun</span> <span class="id" title="var">n</span> <span class="id" title="var">k</span> = <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> (<span class="id" title="var">fac</span> <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span>]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn'</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab827"></a><h1 class="section">CPS (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">plus</span> (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">S</span> (<span class="id" title="var">plus</span> <span class="id" title="var">n'</span> <span class="id" title="var">m</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">plusCPS</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">A</span>) : <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" title="var">k</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n'</span> =&gt; <span class="id" title="var">plusCPS</span> <span class="id" title="var">n'</span> <span class="id" title="var">m</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">res</span> =&gt; <span class="id" title="var">k</span> (<span class="id" title="var">S</span> <span class="id" title="var">res</span>))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">plusCPS_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> <span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">plusCPS</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> = <span class="id" title="var">k</span> (<span class="id" title="var">plus</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">IHn'</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Function</span> <span class="id" title="var">fib</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 1 =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> (<span class="id" title="var">S</span> <span class="id" title="var">n''</span> <span class="id" title="keyword">as</span> <span class="id" title="var">n'</span>) =&gt; <span class="id" title="var">fib</span> <span class="id" title="var">n''</span> + <span class="id" title="var">fib</span> <span class="id" title="var">n'</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">fibCPS</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" title="var">k</span> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 1 =&gt; <span class="id" title="var">k</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> (<span class="id" title="var">S</span> <span class="id" title="var">n''</span> <span class="id" title="keyword">as</span> <span class="id" title="var">n'</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fibCPS</span> <span class="id" title="var">n''</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">arg1</span> =&gt; <span class="id" title="var">fibCPS</span> <span class="id" title="var">n'</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">arg2</span> =&gt; <span class="id" title="var">k</span> (<span class="id" title="var">arg1</span> + <span class="id" title="var">arg2</span>)))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fibCPS_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fibCPS</span> (<span class="id" title="var">S</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)) <span class="id" title="var">k</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fibCPS</span> <span class="id" title="var">n</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">arg1</span> =&gt; <span class="id" title="var">fibCPS</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">arg2</span> =&gt; <span class="id" title="var">k</span> (<span class="id" title="var">arg1</span> + <span class="id" title="var">arg2</span>))).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">fibCPS_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fibCPS</span> <span class="id" title="var">n</span> <span class="id" title="var">k</span> = <span class="id" title="var">k</span> (<span class="id" title="var">fib</span> <span class="id" title="var">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>. <span class="id" title="var">functional</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">fib</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">fibCPS_eq</span>, <span class="id" title="var">IHn0</span>, <span class="id" title="var">IHn1</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab828"></a><h1 class="section">CPS i defunkcjonalizacja w służbie rekursji ogonowej (TODO)</h1>

<div class="paragraph"> </div>

 Tutaj coś w stylu "jak zaimplementować przejście po drzewie" samą
    iteracją, bez rekursji, ale za to ze stosem (który jest niczym innym
    jak zdefunkcjonalizowaną kontynuacją). 
<div class="paragraph"> </div>

<a id="lab829"></a><h1 class="section">Kodowania Churcha (TODO)</h1>

<div class="paragraph"> </div>

 Achtung: póki co wisi tu kod roboczy 
</div>
<div class="code">

<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">clist</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}, <span class="id" title="var">X</span> -&gt; (<span class="id" title="var">A</span> -&gt; <span class="id" title="var">X</span> -&gt; <span class="id" title="var">X</span>) -&gt; <span class="id" title="var">X</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">cnil</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} : <span class="id" title="var">clist</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span> =&gt; <span class="id" title="var">nil</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ccons</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">clist</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">clist</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span> =&gt; <span class="id" title="var">cons</span> <span class="id" title="var">h</span> (<span class="id" title="var">t</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span>).<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;c[]" := <span class="id" title="var">cnil</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;x :c: y" := (<span class="id" title="var">ccons</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 60, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;c[ x ; .. ; y ]" := (<span class="id" title="var">ccons</span> <span class="id" title="var">x</span> .. (<span class="id" title="var">ccons</span> <span class="id" title="var">y</span> <span class="id" title="var">cnil</span>) ..).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chead</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">None</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">h</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">h</span>).<br/>

<br/>
<span class="id" title="keyword">Unset</span> <span class="id" title="var">Universe</span> <span class="id" title="var">Checking</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ctail</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">clist</span> <span class="id" title="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> (@<span class="id" title="var">option</span> (<span class="id" title="var">clist</span> <span class="id" title="var">A</span>)) <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">c</span>[]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">t'</span> =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">ccons</span> <span class="id" title="var">h</span> <span class="id" title="var">t'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">ctail</span> <span class="id" title="var">c</span>[].<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">ctail</span> <span class="id" title="var">c</span>[1].<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">ctail</span> <span class="id" title="var">c</span>[1; 2].<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">ctail</span> <span class="id" title="var">c</span>[1; 2; 3].<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">ctail</span> <span class="id" title="var">c</span>[1; 2; 3; 4].<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">null</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">true</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">clen</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> <span class="id" title="var">nat</span> 0 (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">S</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">snoc</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">clist</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span> =&gt; <span class="id" title="var">l</span> <span class="id" title="var">_</span> (<span class="id" title="var">c</span>[<span class="id" title="var">x</span>] <span class="id" title="var">_</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span>) <span class="id" title="var">cons</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">rev</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">clist</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">capp</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">clist</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span> =&gt; <span class="id" title="var">l1</span> <span class="id" title="var">X</span> (<span class="id" title="var">l2</span> <span class="id" title="var">X</span> <span class="id" title="var">nil</span> <span class="id" title="var">cons</span>) <span class="id" title="var">cons</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">fromList</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">clist</span> <span class="id" title="var">A</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" title="var">cnil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">h</span> :: <span class="id" title="var">t</span> =&gt; <span class="id" title="var">ccons</span> <span class="id" title="var">h</span> (<span class="id" title="var">fromList</span> <span class="id" title="var">t</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">toList</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>) [] (@<span class="id" title="var">cons</span> <span class="id" title="var">A</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">toList_fromList</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">toList</span> (<span class="id" title="var">fromList</span> <span class="id" title="var">l</span>) = <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h</span> <span class="id" title="var">t</span>]; <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">IHt</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fromList_toList</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">cl</span> : <span class="id" title="var">clist</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fromList</span> (<span class="id" title="var">toList</span> <span class="id" title="var">cl</span>) = <span class="id" title="var">cl</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">clist</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">compute</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Universe</span> <span class="id" title="var">Checking</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">wut</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>, (<span class="id" title="var">X</span> -&gt; <span class="id" title="var">X</span>) -&gt; <span class="id" title="var">X</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wut_wut</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">wut</span> -&gt; <span class="id" title="var">False</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">wut</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">trivial</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab830"></a><h1 class="section">Kodowania Scotta (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Scott</span>.<br/>

<br/>
<span class="id" title="keyword">Unset</span> <span class="id" title="var">Positivity</span> <span class="id" title="var">Checking</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Scott</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">scott</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">X</span> -&gt; (<span class="id" title="var">A</span> -&gt; <span class="id" title="var">Scott</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">X</span>) -&gt; <span class="id" title="var">X</span>;<br/>
}.<br/>

<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">scott</span> {<span class="id" title="var">A</span>}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">nil</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} : <span class="id" title="var">Scott</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;{| <span class="id" title="var">scott</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">n</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">n</span> |}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">cons</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">Scott</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Scott</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;{| <span class="id" title="var">scott</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">c</span> =&gt; <span class="id" title="var">c</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> |}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">l</span> : <span class="id" title="var">Scott</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">cons</span> 1 (<span class="id" title="var">cons</span> 2 (<span class="id" title="var">cons</span> 3 <span class="id" title="var">nil</span>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">head</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">Scott</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">scott</span> <span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">None</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">a</span>).<br/>

<br/>
<span class="id" title="keyword">Unset</span> <span class="id" title="var">Universe</span> <span class="id" title="var">Checking</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">tail</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">Scott</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">Scott</span> <span class="id" title="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">scott</span> <span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">None</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">t</span>).<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">tail</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Unset</span> <span class="id" title="var">Guard</span> <span class="id" title="var">Checking</span>.<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">toList</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">Scott</span> <span class="id" title="var">A</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">l</span>} : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">scott</span> <span class="id" title="var">l</span> <span class="id" title="var">_</span> [] (<span class="id" title="keyword">fun</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">h</span> :: <span class="id" title="var">toList</span> <span class="id" title="var">t</span>).<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">toList</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Compute</span> <span class="id" title="var">toList</span> (<span class="id" title="keyword">match</span> <span class="id" title="var">tail</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="var">nil</span> | <span class="id" title="var">Some</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">t</span> <span class="id" title="keyword">end</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Scott</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab831"></a><h1 class="section">Listy różnicowe (TODO)</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">DList</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">rep</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">DList</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span> =&gt; <span class="id" title="var">l</span> ++ <span class="id" title="var">l'</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">abs</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">DList</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> [].<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">rep_abs</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">abs</span> (<span class="id" title="var">rep</span> <span class="id" title="var">l</span>) = <span class="id" title="var">l</span>.<br/>

<br/>
<span class="comment">(*&nbsp;end&nbsp;hide&nbsp;*)</span><br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FunctionalExtensionality</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">abs_rep_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">DList</span> <span class="id" title="var">A</span>) (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l</span> <span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span> = <span class="id" title="var">l</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">l2</span>. <span class="id" title="var">revert</span> <span class="id" title="var">l</span> <span class="id" title="var">l1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l2</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h2</span> <span class="id" title="var">t2</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l1</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h1</span> <span class="id" title="var">t1</span>]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHt2</span> <span class="id" title="var">l</span> (<span class="id" title="var">h1</span> :: <span class="id" title="var">t1</span> ++ [<span class="id" title="var">h2</span>])).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHt2</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHt2</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHt2</span>. <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">abs_rep</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">DList</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rep</span> (<span class="id" title="var">abs</span> <span class="id" title="var">l</span>) = <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">abs</span>, <span class="id" title="var">rep</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">l2</span>. <span class="id" title="tactic">generalize</span> (@<span class="id" title="var">nil</span> <span class="id" title="var">A</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">l1</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>
<span class="comment">(*&nbsp;end&nbsp;hide&nbsp;*)</span></div>
